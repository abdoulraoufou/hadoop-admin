# 6 machines virtuelles debian wheezy. 1 machine maitre (NameNode) et 5 machines esclaves (DataNode). 

# Faire ifconfig pour trouver l'IP qui repond sur eth0. C'est cette IP qui sera par la suite utilisée dans /etc/hosts
ifconfig -a

# Paramétrer le fichier /etc/hosts de chaque noeud
sudo nano /etc/hosts

# Ajouter le code suivant dans le fichier /etc/hosts
"""
abdoop-cluster-maitre 10.240.41.135 
abdoop-cluster-maitre-bis 10.240.31.131
abdoop-cluster-slave1 10.240.173.163 
abdoop-cluster-slave2 10.240.162.217 
abdoop-cluster-slave3 10.240.40.36 
abdoop-cluster-slave4 10.240.129.114 
abdoop-cluster-slave5 10.240.48.112
"""

# Ajouter l'utilisateur hadoopmanager
sudo adduser hadoopmanager # mot de passe: hadoop

# Désactiver le mot de passe du compte utilisateur hadoopmanager
sudo nano /etc/sudoers
# Ajouter ce code dans le fichier /etc/sudoers
"""
hadoopmanager     ALL=NOPASSWD: ALL
araoufougambo_netbooster_com ALL=NOPASSWD: ALL
"""

# Générer une clé ssh sur le noeud maitre pour pouvoir ouvrir une session sur le noued sans fournir le mot de passe
ssh-keygen -t rsa -P ""

# Ajouter la clé publique à la liste des clés acceptées
cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys

# Copier la clé publique sur les autres machines du cluster
## 1-via ssh-copy-id
ssh-copy-id -i ~/.ssh/id_dsa.pub hadoopmanager@abdoop-cluster-maitre-bis
## 2-Copier la clé dans les métadonnées (cas de google compute engine)

#--------------------------------------------------------#
#- Installation et configuration d'un cluster multinœud -#
#--------------------------------------------------------#
# Installation Cloudera Manager dans abdoop-cluster-maitre
wget http://archive-primary.cloudera.com/cm5/installer/5.1.2/cloudera-manager-installer.bin

# Modifier les droits afin d'autoriser l'exécution puis exécuter le binaire en root
chmod u+x cloudera-manager-installer.bin
sudo ./cloudera-manager-installer.bin

# Suivre l'interface graphique pour la suite d'installation.


